<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin E-Voting</title>
</head>

<body>

<h2>Panel Admin E-Voting</h2>

<!-- FORM PEMILIH -->
<input id="namaPemilih" placeholder="Nama Pemilih">
<input id="emailPemilih" placeholder="Email Pemilih">
<input id="passwordPemilih" placeholder="Password Pemilih">
<button onclick="addPemilih()">Tambah Pemilih</button>

<h3>Daftar Pemilih</h3>
<table border="1">
  <thead>
    <tr>
      <th>Nama</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="listPemilih"></tbody>
</table>

<hr>

<!-- FORM KANDIDAT -->
<input id="namaKandidat" placeholder="Nama Kandidat">
<textarea id="visiMisi" placeholder="Visi & Misi"></textarea>
<button onclick="addKandidat()">Tambah Kandidat</button>

<!-- ================= SCRIPT HARUS DI SINI ================= -->
<script type="module">

import { db } from "./firebase.js";
import {
  collection,
  getDocs,
  doc,
  setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* LOAD PEMILIH */
async function loadPemilih() {
  const tbody = document.getElementById("listPemilih");
  tbody.innerHTML = "";

  const snap = await getDocs(collection(db, "pemilih"));
  snap.forEach(docu => {
    const d = docu.data();
    tbody.innerHTML += `
      <tr>
        <td>${d.nama}</td>
        <td>${d.sudahMemilih ? "✅ Sudah Memilih" : "❌ Belum Memilih"}</td>
      </tr>
    `;
  });
}

/* TAMBAH PEMILIH */
window.addPemilih = async () => {
  const nama = namaPemilih.value;
  const email = emailPemilih.value;
  const pass = passwordPemilih.value;

  if (!nama || !email || !pass) {
    alert("Lengkapi data");
    return;
  }

  const kode = "KT" + Date.now(); // kode unik

  await setDoc(doc(db, "pemilih", kode), {
    nama,
    email,
    password: pass,
    sudahMemilih: false
  });

  alert("Pemilih ditambahkan\nKode: " + kode);
  loadPemilih();
};

loadPemilih();

</script>
</body>
</html>
